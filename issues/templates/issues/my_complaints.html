{% extends 'issues/base.html' %}
{% block title %}My reports — CampusConnect{% endblock %}
{% block content %}
<!-- added: back button -->
<a href="javascript:history.back()" class="btn btn-sm btn-outline-secondary mb-3">← Back</a>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="m-0">My reports</h3>
  <a class="btn btn-sm btn-outline-primary" href="{% url 'issues:create_complaint' %}">New report</a>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <form class="row g-2 mb-3" method="get" action="{% url 'issues:my_complaints' %}">
      <div class="col-md-6">
        <input name="q" class="form-control" placeholder="Search your reports..." value="{{ request.GET.q }}">
      </div>
      <div class="col-md-3">
        <select name="status" class="form-select">
          <option value="">All statuses</option>
          <option value="open">Open</option>
          <option value="in_progress">In Progress</option>
          <option value="resolved">Resolved</option>
          <option value="closed">Closed</option>
        </select>
      </div>
      <div class="col-md-3 text-end">
        <button class="btn btn-primary">Filter</button>
      </div>
    </form>

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Title</th>
            <th>Category</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Updated</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for c in complaints %}
          <tr>
            <td>{{ c.id }}</td>
            <td><a href="{% url 'issues:view_complaint' c.pk %}">{{ c.title }}</a></td>
            <td class="text-muted small">{{ c.category }}</td>
            <td>
              {% if c.priority == 'high' %}
                <span class="badge bg-danger">{{ c.get_priority_display }}</span>
              {% elif c.priority == 'medium' %}
                <span class="badge bg-warning text-dark">{{ c.get_priority_display }}</span>
              {% else %}
                <span class="badge bg-secondary">{{ c.get_priority_display }}</span>
              {% endif %}
            </td>
            <td>
              {% if c.status == 'open' %}
                <span class="badge bg-primary">{{ c.get_status_display }}</span>
              {% elif c.status == 'in_progress' %}
                <span class="badge bg-info text-dark">{{ c.get_status_display }}</span>
              {% elif c.status == 'resolved' %}
                <span class="badge bg-success">{{ c.get_status_display }}</span>
              {% else %}
                <span class="badge bg-dark">{{ c.get_status_display }}</span>
              {% endif %}
            </td>
            <td class="small text-muted">{{ c.updated_at|date:'M d, Y' }}</td>
            <td><a class="btn btn-sm btn-outline-secondary" href="{% url 'issues:view_complaint' c.pk %}">View</a></td>
          </tr>
          {% empty %}
          <tr><td colspan="7" class="text-center text-muted">No reports yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}